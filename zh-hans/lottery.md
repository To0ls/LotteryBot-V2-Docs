# 中奖结果的计算

> Revision 1

为确保公平公正，我们使用以太坊区块链数据来计算获奖者。

## 计算方式

### 准备数据

1. 抽奖 ID、抽奖人数与奖品份数。
2. 公示的所有参与用户的 [User ID Hash](#user-id-hash-的计算方式)，将这些 ID 写入一个数组，并按 ASCII 码从大到小分配 0 开始的自增 ID。
3. 开奖时间之后的第一个以太坊 Block Hash (不包含 `0x` 前缀)。

我们准备了一个 API 接口以获取这些数据。

``` 
# curl https://lottery.tg/lottery/{Lottery_ID}/data
```

### 计算初始开奖种子

伪代码， `sha256` 函数返回格式为小写 Hex 字符串， `+` 号为拼接字符串。

``` 
开奖种子 = sha256(抽奖ID + 参与人数 + 总奖品份数 + Block Hash)
```

### 计算中奖人

> 须使用大数运算

1. 将 `开奖种子` 的 16 进制转换为 10 进制。
2. 将该十进制数字除以总参与人数，余数对应的自增 ID 即为中奖人，奖品按顺序发放。
3. 如该用户已在中奖列表或不符合中奖条件，或者尚有未开奖品，则将 `开奖种子` 再次 SHA256，作为新的 `开奖种子` ，回到第 1 步再次计算，直到所有奖品分发完成。

## 验证工具

我们提供了用于自行验证中奖结果的工具。该工具是 [开源的]([../tools/verify-tool/](https://github.com/WooMaiLabs/LotteryBot-V2-Docs/tree/master/tools/verify-tool))。

## 附录

### User ID Hash 的计算方式

我们在设计算法时尽可能同时保证透明公开与用户隐私。<br>
在计算中奖人时，计算 User ID Hash 的伪代码如下，其中 `+` 号为拼接字符串:

``` 
User ID Hash = sha256(User ID + 抽奖ID)
```

### 如何提高自己的中奖概率？

首先，你需要拥有可观的以太坊算力（越多概率越高）参与挖矿。<br>
如果你挖出了区块并且计算出自己没有中奖，则可以放弃这个区块（包含当前价值近千美元的区块奖励），然后在期望没有其他矿工抢先的情况下，自己挖出的下一个区块可以让自己中奖。
